<link rel="import" href="/public/bower_components/polymer/polymer.html">
<link rel="import" href="/public/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/public/bower_components/iron-list/iron-list.html">
<link rel="import" href="/public/bower_components/paper-material/paper-material.html">

<dom-module id="post-list">

    <style>
        paper-material {
        	margin: 16px 16px 0 16px;
        	padding: 20px;
        }

        .actions a {
        	color: black;
        	text-decoration: none;
        }
    </style>

	<template>
		<iron-ajax url="/post/list.json" last-response={{data}} auto></iron-ajax>
		<iron-list items="[[data]]" as="item">
			<template>
			    <div class="item">
					<paper-material elevation="1">
						<aside>
							<p>[[getDateDOM(item.CreatedAt)]]</p>
							<paper-button raised class="actions">
							    <a href="">
							    	<iron-icon icon="editor:mode-edit"></iron-icon>
							    	Edit
							    </a>
							</paper-button>

							<template is="dom-if" if="{{ checkPublished(item) }}">
							Published!
							</template>

							<template is="dom-if" if="{{ !checkPublished(item) }}">
							Unpublished!
							</template>
						</aside>
						<article class="post-content">
						    <h3>[[item.Title]]</h3>
						    <p>[[getFirstParagraph(item.Content)]]</p>
						</article>
					</paper-material>
				</div>
			</template>
		</iron-list>
	</template>

	<script>
	var MonthNames = [
	    "Jan", "Feb", "Mar", "Apr", "May", "Jun", 
	    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
	];

	Polymer({
		is: "post-list",
		getFirstParagraph: function (content) {
			var div = document.createElement("div");
			div.innerHTML = content;

			return div.firstChild.textContent;
		},
		checkPublished: function (item) {
			return item.Published === true;
		},
		getDateDOM: function (date) {
			var jsDate = this.RFC3339ToDate(date),
			    result = jsDate.getDate()  + " " +
			             MonthNames[jsDate.getMonth()] + " " + 
			             jsDate.getFullYear();

			return result;
		},
		// because golang's default time.Time format
		// is on RFC3339
		RFC3339ToDate: function (date) {
			var epoch = Date.parse(date);

			return new Date(epoch);
		}
	});
	</script>
</dom-module>